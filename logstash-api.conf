input {
  file {
    path => ["/Volumes/Transcend/data/logs/article/api/*.log"]
    codec => "json"
    add_field => { "app" => "api" }
  }
}

filter {
  if [app] == "api" {
    date {
      match => ["log_time", "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'"]
      target => "log_time"
      timezone => "UTC"
    }
    date {
      match => ["req_time", "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'"]
      target => "req_time"
      timezone => "UTC"
    }
  }
}

output {
  if [app] == "api" {
    elasticsearch {
      hosts => ["http://localhost:9200"]
      index => "logstash-api-m-%{+YYYY.MM}"
    }
  }
}
